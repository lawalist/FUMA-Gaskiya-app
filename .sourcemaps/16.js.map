{"version":3,"sources":["../../src/components/form-view/form-view.module.ts","../../src/components/form-view/form-view.ts","../../src/pages/tabs/collect/collect.ts","../../src/pages/tabs/collect/collect.module.ts"],"names":[],"mappings":"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","file":"16.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicModule } from 'ionic-angular';\r\nimport { FormViewComponent } from './form-view';\r\n//import { TranslationModule } from '../../translation/translate.module'\r\nimport { TranslateModule, TranslateLoader } from '@ngx-translate/core';\r\n\r\n@NgModule({\r\n  declarations: [FormViewComponent],\r\n  imports: [TranslateModule, IonicModule],\r\n  exports: [FormViewComponent]\r\n})\r\nexport class FormViewComponentModule { }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/form-view/form-view.module.ts","import { Component, Input, Output, EventEmitter } from '@angular/core';\r\nimport { NavParams, ViewController } from 'ionic-angular';\r\nimport { DomSanitizer, SafeResourceUrl } from '@angular/platform-browser';\r\nimport { Camera } from '@ionic-native/camera';\r\nimport { PouchdbProvider } from '../../providers/pouchdb-provider';\r\nimport { Storage } from '@ionic/storage';\r\n\r\n@Component({\r\n  selector: 'form-view',\r\n  templateUrl: 'form-view.html'\r\n})\r\n\r\nexport class FormViewComponent {\r\n  form: any;\r\n  enketoLink: SafeResourceUrl;\r\n  instanceID: String;\r\n  public base64Image: String;\r\n  public showCamera = true;\r\n  local: Storage;\r\n  opened: Boolean = false;\r\n  opacity: Number = 0;\r\n  pointerEvents: String = 'none';\r\n  tabBarElement: any;\r\n  iframeHeight: any;\r\n\r\n  // define input properties. assign variable iframSrc from src property\r\n  @Input('src') iframeSrc;\r\n  @Input('form') iframeForm;\r\n  @Output() onFormClosed = new EventEmitter<any>();\r\n\r\n  constructor(private params: NavParams, public viewCtrl: ViewController, private sanitizer: DomSanitizer, private database: PouchdbProvider, private camera: Camera) {\r\n    this.tabBarElement = document.querySelector('.tabbar');\r\n    this.iframeHeight=(window.innerHeight-54)+\"px\"\r\n  }\r\n  ngOnChanges(changes) {\r\n    if (changes.iframeForm && !changes.iframeForm.firstChange && changes.iframeForm.currentValue.doc) {\r\n      this.form = changes.iframeForm.currentValue.doc\r\n      this.open();\r\n    }\r\n  }\r\n  ngAfterViewInit() {\r\n\r\n\r\n    // console.log('setting iframe source',this.iframeSrc);\r\n    // this.enketoLink = this.sanitizer.bypassSecurityTrustResourceUrl(this.iframeSrc);\r\n\r\n    //add event listener for messages sent from enketo iframe\r\n    //note - currently not useful as enketo only correctly firing message on edit start but not submission success\r\n    //https://github.com/kobotoolbox/enketo-express/issues/670\r\n    window.addEventListener(\"message\", receiveMessage, false);\r\n    function receiveMessage(event) {\r\n      // TODO in real life, check origin! if (event.origin !== \"http://enk.to:8080\") return;\r\n      console.log('data received from iframe', event);\r\n    }\r\n\r\n  }\r\n  ionViewDidLoad() { }\r\n  \r\n  open() {\r\n    this.instanceID = this.setInstanceID();\r\n    var link = this.setIframeLink(this.form.enketoLink);\r\n    this.enketoLink = this.sanitizer.bypassSecurityTrustResourceUrl(link);\r\n    this.opacity = 1;\r\n    this.pointerEvents = 'auto';\r\n    this.opened = true;\r\n    this.tabBarElement.style.display = 'none';\r\n    this.onFormClosed.emit('opened');\r\n  };\r\n\r\n  close() {\r\n    this.opacity = 0;\r\n    this.pointerEvents = 'none';\r\n    this.tabBarElement.style.display = 'flex';\r\n    this.onFormClosed.emit('closed');\r\n  }\r\n  takePhoto() {\r\n    // console.log('hacking into enketo storage');\r\n    // this.local = new Storage(['indexeddb', 'websql', 'localstorage'], { name: 'enketo', storeName: 'keyvaluepairs' });\r\n    // this.local.get('properties').then(res => console.log('get request', res))\r\n    // this.local.set('test','hii')\r\n    this.camera.getPicture({\r\n      destinationType: this.camera.DestinationType.DATA_URL,\r\n      quality: 50,\r\n      targetWidth: 1000,\r\n      targetHeight: 1500,\r\n      saveToPhotoAlbum: false,\r\n      correctOrientation: true\r\n    }).then((imageData) => {\r\n      // imageData is a base64 encoded string\r\n      this.base64Image = \"data:image/jpeg;base64,\" + imageData;\r\n      let fileName = this.instanceID + '.jpeg'\r\n      var doc = {\r\n        _attachments: {},\r\n        photoID: this.instanceID,\r\n        timestamp: new Date().toString(),\r\n      }\r\n      doc._attachments[fileName] = {\r\n        content_type: 'image/jpeg',\r\n        data: imageData\r\n      }\r\n      this.database.put(doc, 'photos_' + this.form.id_string + '/' + this.instanceID)\r\n    }, (err) => {\r\n      console.log(err);\r\n    });\r\n  }\r\n  setIframeLink(link) {\r\n    console.log('setting iframe link', link)\r\n    //create autopopulate query parameters (currently only a deprecated instanceID, later could pull multiple)\r\n    //need to make sure field isn't removed in future update. Query logged on other ways to populate a non interactive element (so user can't change it)\r\n    var fillField = \"meta/instanceID\";\r\n    var fillValue = this.instanceID;\r\n    var fillQueryParam = \"[/\" + this.form.id_string + '/' + fillField + \"]=\" + fillValue;\r\n    //add callback window parameter to receive postmessage from enketo iframe\r\n    var origin = window.location.origin\r\n    var originQueryParam = \"parentWindowOrigin=\" + encodeURI(origin)\r\n    //rewrite url to put query params before id for offline form \r\n    //more info see https://help.ona.io/faq/prefilling-form-fields-using-enketo and https://github.com/kobotoolbox/enketo-express/issues/386\r\n    //warning - could easily be broken by changes to enketo\r\n    var stringLength = link.length\r\n    var linkPrefix = link.slice(0, stringLength - 7)\r\n    var linkSuffix = link.slice(stringLength - 5)\r\n    return linkPrefix + '_/?d' + fillQueryParam + '&' + originQueryParam + linkSuffix\r\n    // var testLink1= 'https://ee.kobotoolbox.org/_/?d[/fuma-op-membre/nom_Membre]=chris#YPfh'\r\n    // var testLink2= 'https://ee.kobotoolbox.org/_/?parentWindowOrigin=http%3A%2F%2Flocalhost:8100#YPfh'\r\n    //var testLink3= 'https://ee.kobotoolbox.org/::YPfh?parentWindowOrigin=http%3A%2F%2Flocalhost:8100#YPfh'\r\n  }\r\n  setInstanceID() {\r\n    //code used by polymer to create pushid. As not exposed to api (?) running manually\r\n    // https://gist.github.com/mikelehen/3596a30bd69384624c11\r\n    //https://firebase.googleblog.com/2015/02/the-2120-ways-to-ensure-unique_68.html\r\n    // Modeled after base64 web-safe chars, but ordered by ASCII.\r\n    var PUSH_CHARS = '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz';\r\n    // Timestamp of last push, used to prevent local collisions if you push twice in one ms.\r\n    var lastPushTime = 0;\r\n    // We generate 72-bits of randomness which get turned into 12 characters and appended to the\r\n    // timestamp to prevent collisions with other clients.  We store the last characters we\r\n    // generated because in the event of a collision, we'll use those same characters except\r\n    // \"incremented\" by one.\r\n    var lastRandChars = [];\r\n    var now = new Date().getTime();\r\n    var duplicateTime = (now === lastPushTime);\r\n    lastPushTime = now;\r\n    var timeStampChars = new Array(8);\r\n    for (var i = 7; i >= 0; i--) {\r\n      timeStampChars[i] = PUSH_CHARS.charAt(now % 64);\r\n      // NOTE: Can't use << here because javascript will convert to int and lose the upper bits.\r\n      now = Math.floor(now / 64);\r\n    }\r\n    if (now !== 0) throw new Error('We should have converted the entire timestamp.');\r\n    var id = timeStampChars.join('');\r\n    if (!duplicateTime) {\r\n      for (i = 0; i < 12; i++) {\r\n        lastRandChars[i] = Math.floor(Math.random() * 64);\r\n      }\r\n    } else {\r\n      // If the timestamp hasn't changed since last push, use the same random number, except incremented by 1.\r\n      for (i = 11; i >= 0 && lastRandChars[i] === 63; i--) {\r\n        lastRandChars[i] = 0;\r\n      }\r\n      lastRandChars[i]++;\r\n    }\r\n    for (i = 0; i < 12; i++) {\r\n      id += PUSH_CHARS.charAt(lastRandChars[i]);\r\n    }\r\n    if (id.length != 20) throw new Error('Length should be 20.');\r\n    return id\r\n  };\r\n}\r\n\r\n\r\n\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/form-view/form-view.ts","import { Component, EventEmitter, Input, Output } from '@angular/core';\r\nimport { NavController, NavParams, ModalController, IonicPage } from 'ionic-angular';\r\nimport { PouchdbProvider } from '../../../providers/pouchdb-provider';\r\nimport { FormViewComponent } from '../../../components/form-view/form-view';\r\nimport { TranslateService } from '@ngx-translate/core'\r\nimport { global } from '../../../global-variables/variable'\r\n\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-collect',\r\n  templateUrl: 'collect.html'\r\n})\r\nexport class CollectPage {\r\n  public forms: any;\r\n  public empty = true;\r\n  public devMode = false;\r\n  public show;\r\n  public enketoLink:String;\r\n  public enketoForm:Object;\r\n\r\n\r\n  constructor(public translate: TranslateService, public navCtrl: NavController, public navParams: NavParams, private database: PouchdbProvider, public modalCtrl: ModalController) { \r\n    this.translate.setDefaultLang(global.langue);\r\n  }\r\n  \r\n  onFormClosed(e) {\r\n    //reset form on close so can later retrigger\r\n    if (e == 'closed') {\r\n      this.enketoForm = {}\r\n    }\r\n    \r\n  }\r\n\r\n  ionViewDidEnter() {\r\n    this.translate.use(global.langue);\r\n    //query all koboForms, load\r\n    console.log('ionViewDidLoad CollectPage');\r\n    this.database.getAll(\r\n      {\r\n        startkey: 'koboForms',\r\n        endkey: 'koboForms\\uffff',\r\n        include_docs:true\r\n      },\r\n      \r\n    ).then(\r\n      res => {\r\n        console.log('res', res)\r\n        this.forms = res.rows\r\n        if (res.rows.length > 0) {\r\n          this.empty = false\r\n        }\r\n          \r\n        //   this.forms = baseForms\r\n        //   this.database.bulkDocs(baseForms)\r\n        //     .then(res => console.log('res', res))\r\n        //     .catch(err => console.log('error', err))\r\n        }) \r\n      }\r\n\r\n\r\n  loadForm(form) {\r\n    console.log('loading form',form)\r\n    this.enketoForm=form;\r\n    //this.navCtrl.push(FormViewPage,form)\r\n\r\n    // let formModal = this.modalCtrl.create(FormViewPage, form, {\r\n    //   showBackdrop: false,\r\n    //   enableBackdropDismiss: false\r\n    // });\r\n    // formModal.onDidDismiss(data => {\r\n    //   console.log('dismissed data',data)\r\n    // });\r\n    // formModal.present();\r\n  }\r\n  devScripts() {\r\n    console.log('running dev script')\r\n    for (let form of baseForms) {\r\n      var id = \"koboForms_\" + form.id_string+\"_\"+form.formid\r\n      this.database.put(form,id)      \r\n    }\r\n    \r\n  }\r\n\r\n}  \r\n\r\n//a selection of forms to be available at start\r\nvar baseForms = [\r\n  {\r\n    url: \"https://kc.kobotoolbox.org/api/v1/forms/84309\",\r\n    formid: 84309,\r\n    summaries: [\r\n      { field: '_id', metric: 'count', display: \"Total datapoints:\" },\r\n    ],\r\n    metadata: [{\r\n      url: \"https://kc.kobotoolbox.org/api/v1/metadata/274728\",\r\n      id: 274728, xform: 84309, data_value: \"\", data_type: \"data_license\", data_file: null, data_file_type: null, file_hash: null\r\n    }, { url: \"https://kc.kobotoolbox.org/api/v1/metadata/274727\", id: 274727, xform: 84309, data_value: \"\", data_type: \"form_license\", data_file: null, data_file_type: null, file_hash: null }, { url: \"https://kc.kobotoolbox.org/api/v1/metadata/274726\", id: 274726, xform: 84309, data_value: \"\", data_type: \"source\", data_file: null, data_file_type: null, file_hash: null }, { url: \"https://kc.kobotoolbox.org/api/v1/metadata/274725\", id: 274725, xform: 84309, data_value: \"\", data_type: \"public_link\", data_file: null, data_file_type: null, file_hash: null }],\r\n    owner: \"https://kc.kobotoolbox.org/api/v1/users/fumagaskiya1\",public: false, public_data: false, require_auth: false, submission_count_for_today: 0, tags: [],\r\n    title: \"Formulaire Organisation des producteur\",\r\n    enketoLink: \"https://ee.kobotoolbox.org/x/#YPfp\", users: [{ role: \"owner\", user: \"fumagaskiya1\", permissions: [\"add_datadictionary\", \"add_xform\", \"change_datadictionary\", \"change_xform\", \"delete_datadictionary\", \"delete_xform\", \"move_xform\", \"report_xform\", \"transfer_xform\", \"view_xform\"] }], hash: \"md5:884d03db13a1839728fb6af891538dd3\",\r\n    description: \"Formulaire Organisation des producteur\", downloadable: true, allows_sms: false, encrypted: false, sms_id_string: \"fuma-op\", id_string: \"fuma-op\", date_created: \"2017-02-08T07:47:56.036026Z\", date_modified: \"2017-02-08T14:00:35.953585Z\", last_submission_time: \"2017-02-08T14:00:35.935111Z\", uuid: \"b213206ea6674e3982fce1e331e9454f\", bamboo_dataset: \"\", instances_with_geopoints: false, num_of_submissions: 5\r\n  },\r\n  {\r\n    url: \"https://kc.kobotoolbox.org/api/v1/forms/84311\",\r\n    formid: 84311,\r\n    summaries: [\r\n      { field: '_id', metric: 'count', display: \"Total datapoints:\" },\r\n    ],\r\n    visualisations: [\r\n      {\r\n        type: \"vega-lite\",\r\n        public: true,\r\n        description: \"Number of male and female members\",\r\n        spec: {\r\n          description: \"Number of male and female members\",\r\n          mark: \"bar\",\r\n          data: {\r\n            values: []\r\n          },\r\n          \"encoding\": {\r\n            \"x\": { \"field\": \"genre\", \"type\": \"nominal\" },\r\n            \"y\": { \"aggregate\":\"count\",\"field\": \"genre\", \"type\": \"nominal\" },\r\n            \"color\": { \"field\": \"genre\", \"type\": \"nominal\" },\r\n          }\r\n        }\r\n      },\r\n    ],\r\n    metadata: [{ url: \"https://kc.kobotoolbox.org/api/v1/metadata/274748\", id: 274748, xform: 84311, data_value: \"\", data_type: \"data_license\", data_file: null, data_file_type: null, file_hash: null }, { url: \"https://kc.kobotoolbox.org/api/v1/metadata/274747\", id: 274747, xform: 84311, data_value: \"\", data_type: \"form_license\", data_file: null, data_file_type: null, file_hash: null }, { url: \"https://kc.kobotoolbox.org/api/v1/metadata/274746\", id: 274746, xform: 84311, data_value: \"\", data_type: \"source\", data_file: null, data_file_type: null, file_hash: null }, { url: \"https://kc.kobotoolbox.org/api/v1/metadata/274745\", id: 274745, xform: 84311, data_value: \"\", data_type: \"public_link\", data_file: null, data_file_type: null, file_hash: null }], owner: \"https://kc.kobotoolbox.org/api/v1/users/fumagaskiya1\", public: false, public_data: false, require_auth: false, submission_count_for_today: 0, tags: [], title: \"Formulaire Membre d'une Organisation des producteur\",\r\n    enketoLink: \"https://ee.kobotoolbox.org/x/#YPfh\", users: [{ role: \"owner\", user: \"fumagaskiya1\", permissions: [\"add_datadictionary\", \"add_xform\", \"change_datadictionary\", \"change_xform\", \"delete_datadictionary\", \"delete_xform\", \"move_xform\", \"report_xform\", \"transfer_xform\", \"view_xform\"] }], hash: \"md5:ccda42e34a46c10e4a3efba265db98a8\",\r\n    description: \"Formulaire Membre d'une Organisation des producteur\", downloadable: true, allows_sms: false, encrypted: false, sms_id_string: \"fuma-op-membre\", id_string: \"fuma-op-membre\", date_created: \"2017-02-08T08:05:39.037365Z\", date_modified: \"2017-02-08T08:23:49.489807Z\", last_submission_time: null, uuid: \"ba721255f44047c998c8d813e825c955\", bamboo_dataset: \"\", instances_with_geopoints: false, num_of_submissions: 0\r\n  },\r\n  {\r\n    url: \"https://kc.kobotoolbox.org/api/v1/forms/84312\",\r\n    formid: 84312,\r\n    summaries: [\r\n      { field: '_id', metric: 'count', display: \"Total datapoints:\" },\r\n    ],\r\n    metadata: [{ url: \"https://kc.kobotoolbox.org/api/v1/metadata/274752\", id: 274752, xform: 84312, data_value: \"\", data_type: \"data_license\", data_file: null, data_file_type: null, file_hash: null }, { url: \"https://kc.kobotoolbox.org/api/v1/metadata/274751\", id: 274751, xform: 84312, data_value: \"\", data_type: \"form_license\", data_file: null, data_file_type: null, file_hash: null }, { url: \"https://kc.kobotoolbox.org/api/v1/metadata/274750\", id: 274750, xform: 84312, data_value: \"\", data_type: \"source\", data_file: null, data_file_type: null, file_hash: null }, { url: \"https://kc.kobotoolbox.org/api/v1/metadata/274749\", id: 274749, xform: 84312, data_value: \"\", data_type: \"public_link\", data_file: null, data_file_type: null, file_hash: null }], owner: \"https://kc.kobotoolbox.org/api/v1/users/fumagaskiya1\", public: false, public_data: false, require_auth: false, submission_count_for_today: 0, tags: [], title: \"Formulaire Organisation des producteur\", enketoLink: \"https://ee.kobotoolbox.org/x/#YPfi\", users: [{ role: \"owner\", user: \"fumagaskiya1\", permissions: [\"add_datadictionary\", \"add_xform\", \"change_datadictionary\", \"change_xform\", \"delete_datadictionary\", \"delete_xform\", \"move_xform\", \"report_xform\", \"transfer_xform\", \"view_xform\"] }], hash: \"md5:fd35075585d3e0d8b7de928407874215\", description:\r\n      \"Formulaire Union des producteur\", downloadable: true, allows_sms: false, encrypted: false, sms_id_string: \"fuma-union\", id_string: \"fuma-union\", date_created: \"2017-02-08T08:15:10.112067Z\", date_modified: \"2017-02-08T08:31:42.111921Z\", last_submission_time: null, uuid: \"fcdde482c94741368e19a7ef415d1bb4\", bamboo_dataset: \"\", instances_with_geopoints: false, num_of_submissions: 0\r\n  }\r\n]\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/tabs/collect/collect.ts","import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { CollectPage } from './collect';\r\n//import { TranslationModule } from '../../../translation/translate.module'\r\nimport { FormViewComponentModule } from '../../../components/form-view/form-view.module'\r\nimport { TranslateModule, TranslateLoader } from '@ngx-translate/core';\r\n\r\n@NgModule({\r\n  declarations: [CollectPage],\r\n  imports: [IonicPageModule.forChild(CollectPage), TranslateModule, FormViewComponentModule],\r\n  exports: [CollectPage]\r\n})\r\nexport class CollectPageModule { }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/tabs/collect/collect.module.ts"],"sourceRoot":""}