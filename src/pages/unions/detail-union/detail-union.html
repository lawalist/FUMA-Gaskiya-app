<!--
  Generated template for the DetailUnion page.

  See http://ionicframework.com/docs/v2/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>

  <ion-navbar color="fuma_primary">

    <ion-buttons start>
     
      <button *ngIf="aProfile == true" ion-button icon-only color="royal" (click)="profile()">
        <ion-icon name="person"></ion-icon>
      </button>

      <button *ngIf="aProfile == false" ion-button icon-only color="royal" (click)="connexion()">
        <ion-icon name="unlock"></ion-icon>
      </button>
    </ion-buttons>
    <ion-title>detail-union</ion-title>
    <ion-buttons end>
      <button ion-button icon-only color="royal" (click)="option()"><ion-icon name="options"></ion-icon></button>
    </ion-buttons>
  </ion-navbar>

</ion-header>

<ion-content padding>
   <!--h4 style="text-align: center; color: seagreen">
    Détail union: {{union._id}}
  </h4-->
  <div *ngIf="!modifierForm">
    <ion-card class="info-card" (dblclick)="editer(union, true)"> 
      <ion-card-header>
        <strong>Information union: {{union.data.num_aggrement}}</strong>
      </ion-card-header>
      <ion-card-content>
        <ion-grid>
          <ion-row> <ion-col class='meta-key'><strong>Numéro aggrément:</strong></ion-col> <ion-col class='meta-value'> {{union.data.num_aggrement}}</ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Code:</strong></ion-col> <ion-col class='meta-value'> {{union.data.code_union}}</ion-col> </ion-row>
          <ion-row *ngIf="union.data.ancien_code_union"> <ion-col class='meta-key'><strong>Ancien code:</strong></ion-col> <ion-col class='meta-value'> {{union.data.ancien_code_union}}</ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Nom:</strong></ion-col> <ion-col class='meta-value'> {{union.data.nom_union}} </ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Nombre d'OP:</strong></ion-col> <ion-col class='meta-value'> {{union.data.num_OP}}</ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Nombre de membres:</strong></ion-col> <ion-col class='meta-value'> {{union.data.num_membre}}</ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Nombre hommes:</strong></ion-col> <ion-col class='meta-value'> {{union.data.num_hommes}}</ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Nombre femmes:</strong></ion-col> <ion-col class='meta-value'> {{union.data.num_femmes}}</ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Date enregistrement:</strong></ion-col> <ion-col class='meta-value'> {{union.data.today | date: 'dd-MM-yyyy'}}</ion-col> </ion-row>
          <ion-row *ngIf="union.data.pays != 'AUTRE' && !union.data.pays_nom"> <ion-col class='meta-key'><strong>Pays:</strong></ion-col> <ion-col class='meta-value'> {{union.data.pays}} </ion-col> </ion-row>
          <ion-row *ngIf="union.data.pays != 'AUTRE' && union.data.pays_nom"> <ion-col class='meta-key'><strong>Pays:</strong></ion-col> <ion-col class='meta-value'> {{union.data.pays_nom}} </ion-col> </ion-row>
          <ion-row *ngIf="union.data.pays == 'AUTRE'"> <ion-col class='meta-key'><strong>Pays:</strong></ion-col> <ion-col class='meta-value'> {{union.data.pays_autre}} </ion-col> </ion-row>
          <ion-row *ngIf="union.data.region != 'AUTRE' && !union.data.region_nom"> <ion-col class='meta-key'><strong>Région:</strong></ion-col> <ion-col class='meta-value'> {{union.data.region}} </ion-col> </ion-row>
          <ion-row *ngIf="union.data.region != 'AUTRE' && union.data.region_nom"> <ion-col class='meta-key'><strong>Région:</strong></ion-col> <ion-col class='meta-value'> {{union.data.region_nom}} </ion-col> </ion-row>
          <ion-row *ngIf="union.data.region == 'AUTRE'"> <ion-col class='meta-key'><strong>Région:</strong></ion-col> <ion-col class='meta-value'> {{union.data.region_autre}} </ion-col> </ion-row>
          <ion-row *ngIf="union.data.departement != 'AUTRE' && !union.data.departement_nom"> <ion-col class='meta-key'><strong>Departement:</strong></ion-col> <ion-col class='meta-value'> {{union.data.departement}} </ion-col> </ion-row>
          <ion-row *ngIf="union.data.departement != 'AUTRE' && union.data.departement_nom"> <ion-col class='meta-key'><strong>Departement:</strong></ion-col> <ion-col class='meta-value'> {{union.data.departement_nom}} </ion-col> </ion-row>
          <ion-row *ngIf="union.data.departement == 'AUTRE'"> <ion-col class='meta-key'><strong>Departement:</strong></ion-col> <ion-col class='meta-value'> {{union.data.departement_autre}} </ion-col> </ion-row>
          <ion-row *ngIf="union.data.commune != 'AUTRE' && !union.data.commune_nom"> <ion-col class='meta-key'><strong>Commune:</strong></ion-col> <ion-col class='meta-value'> {{union.data.commune}}</ion-col> </ion-row>
          <ion-row *ngIf="union.data.commune != 'AUTRE' && union.data.commune_nom"> <ion-col class='meta-key'><strong>Commune:</strong></ion-col> <ion-col class='meta-value'> {{union.data.commune_nom}}</ion-col> </ion-row>
          <ion-row *ngIf="union.data.commune == 'AUTRE'"> <ion-col class='meta-key'><strong>Commune:</strong></ion-col> <ion-col class='meta-value'> {{union.data.commune_autre}}</ion-col> </ion-row>
          <ion-row *ngIf="union.data.village != 'AUTRE' && !union.data.village_nom"> <ion-col class='meta-key'><strong>Village:</strong></ion-col> <ion-col class='meta-value'> {{union.data.village}}</ion-col> </ion-row>
          <ion-row *ngIf="union.data.village != 'AUTRE' && union.data.village_nom"> <ion-col class='meta-key'><strong>Village:</strong></ion-col> <ion-col class='meta-value'> {{union.data.village_nom}}</ion-col> </ion-row>
          <ion-row *ngIf="union.data.village == 'AUTRE'"> <ion-col class='meta-key'><strong>Village:</strong></ion-col> <ion-col class='meta-value'> {{union.data.village_autre}}</ion-col> </ion-row>
          <!--ion-row> <ion-col class='meta-key'><strong>deviceid:</strong></ion-col> <ion-col class='meta-value'> {{union.data.deviceid}}</ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>imei:</strong></ion-col> <ion-col class='meta-value'> {{union.data.imei}}</ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>phonenumber:</strong></ion-col> <ion-col class='meta-value'> {{union.data.phonenumber}}</ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>start:</strong></ion-col> <ion-col class='meta-value'> {{union.data.start | date: 'dd-MM-yyyy'}} à {{union.data.start | date: 'HH:mm:ss'}}</ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>end:</strong></ion-col> <ion-col class='meta-value'> {{union.data.end | date: 'dd-MM-yyyy'}} à {{union.data.end | date: 'HH:mm:ss'}}</ion-col> </ion-row-->
        </ion-grid>
      </ion-card-content>
    </ion-card>

    <ion-card class="info-card" *ngIf="(user && user.roles && global.estManager(user.roles)) || estManager" (dblclick)="editer(union, true)"> 
      <ion-card-header>
        <strong>Plus d'informations</strong>
      </ion-card-header>
      <ion-card-content>
        <ion-grid>
          <ion-row> <ion-col class='meta-key'><strong>Id:</strong></ion-col> <ion-col class='meta-value'> {{union._id }} </ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>No révision:</strong></ion-col> <ion-col class='meta-value'> {{union._rev }} </ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Date création:</strong></ion-col> <ion-col class='meta-value'> {{union.data.created_at | date: 'dd-MM-yyyy'}} à {{union.data.created_at | date: 'HH:mm:ss:ms'}} </ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Créateur:</strong></ion-col> <ion-col class='meta-value'> {{union.data.created_by}} </ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>ID appareil:</strong></ion-col> <ion-col class='meta-value'> {{union.data.deviceid}} </ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Imei:</strong></ion-col> <ion-col class='meta-value'> {{union.data.imei}} </ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Numéro téléphone:</strong></ion-col> <ion-col class='meta-value'> {{union.data.phonenumber}} </ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Date dernière mise à jour:</strong></ion-col> <ion-col class='meta-value'> {{union.data.updatet_at | date: 'dd-MM-yyyy'}}  à {{union.data.updatet_at | date: 'HH:mm:ss:ms'}}</ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Dernière mise à jour par:</strong></ion-col> <ion-col class='meta-value'> {{union.data.updated_by}} </ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>ID appareil:</strong></ion-col> <ion-col class='meta-value'> {{union.data.update_deviceid}} </ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Imei:</strong></ion-col> <ion-col class='meta-value'> {{union.data.update_imei}} </ion-col> </ion-row>
          <ion-row> <ion-col class='meta-key'><strong>Numéro téléphone:</strong></ion-col> <ion-col class='meta-value'> {{union.data.update_phonenumber}} </ion-col> </ion-row>
          <ion-row *ngIf="union.data.deleted"> <ion-col class='meta-key'><strong>Date suppression:</strong></ion-col> <ion-col class='meta-value'> {{union.data.deleted_at | date: 'dd-MM-yyyy'}}  à {{union.data.deleted_at | date: 'HH:mm:ss:ms'}}</ion-col> </ion-row>
          <ion-row *ngIf="union.data.deleted"> <ion-col class='meta-key'><strong>Supprimé par:</strong></ion-col> <ion-col class='meta-value'> {{union.data.deleted_by}} </ion-col> </ion-row>
        </ion-grid>
      </ion-card-content> 
    </ion-card>
  </div>

  <div *ngIf="modifierForm">
    <form [formGroup]="unionForm" (ngSubmit) = "modifierUnion()">

      <ion-item>
        <ion-label floating>Date <span class="error-box">*</span></ion-label>
        <ion-datetime displayFormat="DD/MM/YYYY" formControlName="today" cancelText="Annuler" doneText="Valider" disabled></ion-datetime>
      </ion-item>

      <ion-row>
        <ion-col>
          <ion-item>
            <ion-label floating>Pays <span class="error-box">*</span></ion-label>
            <ion-input *ngIf="union1.pays_nom && union1.pays != 'AUTRE'" type="text" formControlName="pays_nom" disabled></ion-input>
            <ion-input *ngIf="!union1.pays_nom && union1.pays != 'AUTRE'" type="text" formControlName="pays" disabled></ion-input>
            <ion-input *ngIf="union1.pays == 'AUTRE'" type="text" formControlName="pays_autre" disabled></ion-input>
          </ion-item>
        </ion-col>

        <ion-col>
          <ion-item>
            <ion-label floating>Région<span class="error-box">*</span></ion-label>
            <ion-input *ngIf="union1.region_nom && union1.region != 'AUTRE'" type="text" formControlName="region_nom" disabled></ion-input>
            <ion-input *ngIf="!union1.region_nom && union1.region != 'AUTRE'" type="text" formControlName="region" disabled></ion-input>
            <ion-input *ngIf="union1.region == 'AUTRE'" type="text" formControlName="region_autre" disabled></ion-input>
          </ion-item>
        </ion-col>
      </ion-row>

      <ion-row>
        <ion-col>
          <ion-item>
            <ion-label floating>Departement <span class="error-box">*</span></ion-label>
            <ion-input *ngIf="union1.departement_nom && union1.departement != 'AUTRE'" type="text" formControlName="departement_nom" disabled></ion-input>
            <ion-input *ngIf="!union1.departement_nom && union1.departement != 'AUTRE'" type="text" formControlName="departement" disabled></ion-input>
            <ion-input *ngIf="union1.departement == 'AUTRE'" type="text" formControlName="departement_autre" disabled></ion-input>
          </ion-item>
        </ion-col>

        <ion-col>
          <ion-item>
            <ion-label floating>Commune<span class="error-box">*</span></ion-label>
            <ion-input *ngIf="union1.commune_nom && union1.commune != 'AUTRE'" type="text" formControlName="commune_nom" disabled></ion-input>
            <ion-input *ngIf="!union1.commune_nom && union1.commune != 'AUTRE'" type="text" formControlName="commune" disabled></ion-input>
            <ion-input *ngIf="union1.commune == 'AUTRE'" type="text" formControlName="commune_autre" disabled></ion-input>
          </ion-item>
        </ion-col>
      </ion-row>

      <ion-item>
        <ion-label floating>Selectionnez le village <span class="error-box">*</span></ion-label>
        <ion-select formControlName="village" [(ngModel)]="selectedVillageID" cancelText="Annuler" okText="Ok" (ionChange)="chargerAutreNomVillage(selectedVillageID)">
          <ion-option value="" selected disabled>Selectionnez le village</ion-option>
          <ion-option *ngFor="let villag of villages" [value]=villag.id >{{villag.nom}}</ion-option>
        </ion-select>
      </ion-item>
      <div style="padding-left: 15px;" class="error-box" *ngIf="unionForm.controls['village'].hasError('required') && unionForm.controls['village'].touched">* le village est obligatoir!</div>
      
      <ion-item *ngIf="selectedVillageID" [hidden]="selectedVillageID != 'AUTRE'">
        <ion-label floating>Nom village <span class="error-box">*</span></ion-label>
        <ion-input formControlName="village_autre" type="text"  [(ngModel)]="nom_autre_village" ></ion-input>
      </ion-item>
      <div style="padding-left: 15px;" class="error-box" *ngIf="unionForm.controls['village_autre'].hasError('required') && unionForm.controls['village_autre'].touched">* Le nom du village est obligatoire</div>

      <ion-item>
        <ion-label floating>Numéro d'aggrément <span class="error-box">*</span></ion-label>
        <ion-input type="text" formControlName="num_aggrement"></ion-input>
      </ion-item>
      <div style="padding-left: 15px;" class="error-box" *ngIf="unionForm.controls['num_aggrement'].hasError('required') && unionForm.controls['num_aggrement'].touched">* le numéro d'aggrément est obligatoir!</div>

      <ion-item>
        <ion-label floating>Code de l'union <span class="error-box">*</span></ion-label>
        <ion-input type="text" formControlName="code_union" [(ngModel)]="code_union" disabled></ion-input>
      </ion-item>
      <div style="padding-left: 15px;" class="error-box" *ngIf="unionForm.controls['code_union'].hasError('required') && unionForm.controls['code_union'].touched">* le code de l'union des est obligatoir!</div>
      
      <ion-item>
        <ion-label floating>Nom de l'union <span class="error-box">*</span></ion-label>
        <ion-input type="text" formControlName="nom_union" [(ngModel)]="nom_union" ></ion-input>
      </ion-item>
      <div style="padding-left: 15px;" class="error-box" *ngIf="unionForm.controls['nom_union'].hasError('required') && unionForm.controls['nom_union'].touched">* le nom de l'union des est obligatoir!</div>
      
        <br>
        <button ion-button type="submit" color="my_secondary" [disabled]="!unionForm.valid" block>Sauvegarder</button>
    </form>
    <button ion-button color="my_primary" block (click)="annuler()">Annuler</button>
  </div>

  <ion-fab bottom right *ngIf="!modifierForm" >
    <button ion-fab color="fuma-green"><ion-icon name="arrow-dropup"></ion-icon></button>
    <ion-fab-list side="top">
      <button ion-fab mini *ngIf="(user && user.roles && global.estManager(user.roles)) || estManger" (click)="supprimer(union)" color="delete" ><ion-icon name="trash"></ion-icon></button>
      <button ion-fab mini *ngIf="(user && user.roles && global.estAnimataire(user.roles)) || estAnimataire" (click)="openMap(union.data.code_union)" color="my_primary"><ion-icon name="pin"></ion-icon></button>
      <!--button ion-fab mini *ngIf="(user && user.roles && global.estAnimataire(user.roles)) || estAnimataire" (click)="restitution(union.data.code_union)" color="my_primary"><ion-icon name="analytics"></ion-icon></button-->
      <button ion-fab mini *ngIf="(user && user.roles && global.estAnimataire(user.roles)) || estAnimataire" (click)="getStatistique(union.data.code_union)" color="my_primary"><ion-icon name="stats"></ion-icon></button>
      <button ion-fab *ngIf="(user && user.roles && global.estAnimataire(user.roles)) || estAnimataire" (click)="opUnion(union.data.num_aggrement, union.data.nom_union, union.data.code_union)" color="my_primary"><strong>OP</strong></button>
      <button ion-fab mini *ngIf="(user && user.roles && global.estManager(user.roles)) || estManger" (click)="editer(union)" color="my_primary" ><ion-icon name="create"></ion-icon></button>
    </ion-fab-list>
  </ion-fab> 
  
  <!--ion-fab bottom right>
    <button ion-fab mini (click)="editer(union)" color="my_primary" ><ion-icon name="create"></ion-icon></button>
  </ion-fab>

  <ion-fab bottom left>
    <button ion-fab mini (click)="supprimer(union)" color="delete" ><ion-icon name="trash"></ion-icon></button>
  </ion-fab-->

</ion-content>
